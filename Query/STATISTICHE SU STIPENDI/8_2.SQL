-- Somma di tutti gli stipendi mensili negli ultimi 12 mesi raggruppati per dipendente

SELECT CODICE_FISCALE,NOME,COGNOME,SUM(STIPENDIO) AS STIPENDIO_TOTALE_12MM,SUM(STIPENDIO_NETTO) AS STIPENDIO_TOTALE_NETTO_12MM
FROM(SELECT
	 CODICE_FISCALE,NOME,COGNOME,ANNO,MESE,STIPENDIO,STIPENDIO_NETTO,DATEPART('YY',ADD_MONTHS(TODAY,-12))AS A, DATEPART('MM',ADD_MONTHS(TODAY,-12))AS M

FROM
	 CEDOLINI WHERE (ANNO = A AND MESE >= M) OR (ANNO = A + 1 AND MESE < M))
GROUP BY CODICE_FISCALE,NOME,COGNOME